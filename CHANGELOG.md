# Changelog

Все заметные изменения в проекте Acrobeat будут задокументированы в этом файле.

## [Unreleased / MVP Development] - 2025-08-15 to 2025-08-28

### Добавлено (Added)

- **2025-08-15**:
    - Инициализация проекта (Init commit).
    - Базовый функционал скачивания аудио с YouTube (mp3).
    - Интерфейс команды `/start`.
    - Поиск треков на YouTube с выводом 5 вариантов.
    - Базовая структура каталогов, настройка `pyproject.toml`.
    - Docker-compose конфигурация для БД.
    - Интеграция Alembic для миграций.
    - Менеджер пакетов UV.
- **2025-08-17**:
    - Завершена реализация поиска и скачивания треков.
    - Функционал обрезки аудио и добавления звукового сигнала (beep).
    - Скачивание по прямой ссылке YouTube через инлайн-клавиатуру.
    - Рефакторинг и приведение в порядок базовых хендлеров:
        - Все действия через контейнеры.
        - На каждое действие пользователю отображается сообщение.
        - Работает поиск и скачивание по прямой ссылке.
    - Это базовый функционал, требуется дальнейший рефакторинг.
- **2025-08-18**:
    - Реализован второй репозиторий для поиска треков.
    - Поддержка поиска сразу в двух источниках.
    - Требуется доработка скачивания из того репозитория, где был найден трек.
- **2025-08-19**:
    - Добавлен альтернативный источник для поиска и скачивания треков.
    - Абстракция над репозиториями загрузки (downloader) с системой приоритетов.
    - Интеграция Redis для кэширования данных скачивания и ограничения длины ссылок.
    - Сохранение данных пользователя при запуске бота.
    - Кнопка у загруженного трека для повторного поиска.
- **2025-08-20**:
    - Добавлена возможность прерывать выполнение на этапе поиска трека.
    - Сбор данных пользователя для формирования имени трека перед поиском.
- **2025-08-21**:
    - Репозиторий и функционал кэширования введенных пользователем данных (`user_cache_repository`).
    - Хранение и отображение списка введенных ФИО с пагинацией.
    - Глобальное логирование (`logger_setup.py`, `config.yaml`).
    - Добавление эффекта fadeout к обрезанным трекам.
    - Начата реализация обработки загруженных аудиофайлов.
    - Добавлена сортировка для `track_part`.
    - Добавлена инициализация глобального логгера.
    - Начата логика сохранения введённых данных пользователем в БД.
- **2025-08-22**:
    - Обработка прямой загрузки аудиофайлов от пользователя.
    - Скачивание по прямой ссылке с указанием имени трека.
- **2025-08-23**:
    - Добавлены миграции Alembic.
    - Добавлен `Changelog.md`.
    - Создана структура таблиц для хранения треков (`track_storage`).
    - Добавлены модели и миграция для хранения данных о скачанных и обрезанных треках.
- **2025-08-24**:
    - Создана базовая структура для `track_request`:
        - Модели, сервис, репозиторий, схемы.
        - Для хранения истории поиска треков (пока без интеграции в логику).
    - Создана базовая структура для `track_storage`:
        - Модели, сервис, репозиторий, схемы.
        - Для хранения данных о скачанных треках (пока без интеграции в логику).
- **2025-08-25**:
    - Реализован новый функционал для обработки запросов треков (`track-request`):
        - Сохранение поисковых запросов пользователя.
        - Возможность повторного использования ранее введённых запросов.
- **2025-08-28**:
    - Добавлен новый репозиторий загрузки (`download_repo`):
        - Репозиторий **Hitmo** для скачивания треков.
    - Очистка сообщений при вводе имени трека (`msg_cleaner`):
        - Для домена `track_name` реализована очистка истории чата.
    - Перенос состояния FSM (`state`) в Redis:
        - Все сохранения в рамках сессии перенесены в Redis.

### Изменено (Changed)

- **2025-08-19**:
    - Переработана логика сервиса для поочередного поиска и скачивания из нескольких источников.
    - Переделан механизм отправки файлов загрузчиком.
- **2025-08-21**:
    - Проведен рефакторинг кода для улучшения читаемости и исправления мелких ошибок.
- **2025-08-23**:
    - Разнес зависимости (`dependencies`) по доменам.
- **2025-08-24**:
    - Переработана логика обработки треков:
        - История скачиваний отложена как избыточная.
        - Реализовано хранение только истории поиска.
- **2025-08-28**:
    - Вынесена очистка истории сообщений в отдельный сервис (`msg_cleaner`):
        - Хранение данных в Redis.
        - Возможность переиспользования.

### Исправлено (Fixed)

- **2025-08-19**:
    - Исправлены баги, связанные с репозиторием YouTube.
- **2025-08-21**:
    - Исправлен баг с изменением имени трека на этапе подтверждения.
    - Исправлена адресация `callback_data` для инлайн-кнопок.
- **2025-08-22**:
    - Исправлена адресация `callback_data`.
- **2025-08-28**:
    - Исправлено удаление сообщений в кеше (`clipper_delete_message`):
        - Установлен `expire = 1 минута`.
